<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë°©ëª…ë¡</title>
  <link rel="stylesheet" href="../../2.PageElement/Tob_nav/Tob_nav.css" />
  <link rel="stylesheet" href="../../2.PageElement/Footer/Footer.css" />
  <link rel="stylesheet" href="../../2.PageElement/Cursor/cursor.css" />
  <style>
    html, body {
      height: 100%;
    }
    :root { --footer-safe: 0px; }
    .page-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main.content {
      padding-top: 0; /* spacer will handle header height */
      padding-bottom: calc(var(--footer-safe) + 24px);
    }
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background-color: #000;
      color: #fff;
      overflow-x: hidden;
    }
    
      #nav-placeholder header .header-inner{
    max-width: 1600px;
    padding: 0;
    margin: 0 auto;
    display: flex;              /* ì¶”ê°€ */
    align-items: center;        /* ì¶”ê°€ */
    justify-content: space-between; /* ì¶”ê°€ */
    height: 100%;               /* ì¶”ê°€ */
  }
   /* === Tob_nav style (match Guest page) === */
   #nav-placeholder{
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: transform .3s ease;
      will-change: transform;
    }
    body.nav-hidden #nav-placeholder{ transform: translateY(-110%); }
    .nav-spacer{ height: 0; }

    /* Visuals: black translucent + blur + thin divider */
    #nav-placeholder header{
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,.12);
      box-sizing: border-box;
      width: 100%;
      height: 90px;
      padding-left: 59px;
      padding-right: 60px;
    }
    

    /* Logo sizing */
    #nav-placeholder header .logo img{
      max-height: 38px;
      transform: translateY(2px);
    }
    #nav-placeholder .logo .logo-main{ font-size: 15px !important; }
    #nav-placeholder .logo .logo-sub { font-size: 15px !important; }

     /* ë„¤ë¹„ê²Œì´ì…˜: ìŠ¤í¬ë¡¤ ë‚´ë¦¬ë©´ ìˆ¨ê¸°ê³ , ì˜¬ë¦¬ë©´ ë‚˜íƒ€ë‚˜ë„ë¡ (ë ˆì´ì•„ì›ƒ ì í”„ ë°©ì§€) */
     #nav-placeholder { position: sticky; top: 0; z-index: 1000; transition: transform .3s ease; }
    body.nav-hidden #nav-placeholder { transform: translateY(-110%); }

    /* Link typography */
    #nav-placeholder header a{
      font-family: 'Pretendard', sans-serif;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .2px;
      text-decoration: none;
      color: #fff;
      padding: 8px 0;
    }
    #nav-placeholder header a:hover{ color:#ff3b3b; }
    #nav-placeholder header a.is-active{ color:#ff4d4d; font-weight:700; }
    /* â€” nav ê°„ê²©/íŒ¨ë”© ì¶•ì†Œ â€” */
    #nav-placeholder nav ul{ gap:47px; }  /* ê¸°ì¡´ 48px â†’ 32px */

    /* Flatten: disable dropdown menus entirely on Main page (like Guest) */
    #nav-placeholder nav ul li ul,
    #nav-placeholder .dropdown,
    #nav-placeholder .submenu,
    #nav-placeholder .has-dropdown > ul,
    #nav-placeholder .has-children > ul{
      display: none !important;
    }
    #nav-placeholder nav ul li:hover > ul{ display:none !important; }

    .guestbook-container {
      max-width: 1200px;
      margin: 24px auto 0; 
      padding: 20px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 40px;
      background: none;
      border: none;
      border-radius: 0;
      box-shadow: none;
    }

    .guestbook-title {
      font-family: 'Times New Roman', serif;
      font-size: 4.5rem;
      color: white;
      text-align: center;
      margin-bottom: 2rem;
    }

    hr {
      border-color: #ffffff;
    }

    .write-button-wrapper {
      text-align: center;
      margin-bottom: 2rem;
    }

    #toggleWriteForm {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
    }

    .guestbook-form-container.hidden {
      display: none;
    }

    .search-bar {
      margin: 2rem auto;
      display: flex;
      justify-content: center;
    }

    .search-bar input {
      padding: 0.8rem 1rem;
      border-radius: 20px;
      border: 2px solid white;
      background-color: #222;
      color: white;
      font-size: 1rem;
      width: 300px;
    }

    .search-bar input::placeholder {
      color: #ffcccc;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      align-items: stretch; /* ì¤‘ì•™ ì •ë ¬ ì œê±°, ì¢Œìš°ë¡œ ê½‰ ì°¨ê²Œ */
    }

    input, textarea {
      padding: 1rem;
      background: #222;
      color: white;
      border-radius: 12px;
      font-size: 1rem;
      border: 1px solid #333;
      clip-path: none;
      width: 100%;
      margin: 0 auto;
      box-sizing: border-box;
      max-width: 100%;
    }

    input:focus, textarea:focus{
      outline: none;
      border-color: #ff4d4d;
      box-shadow: 0 0 0 2px rgba(255,77,77,0.2);
    }

    textarea {
      resize: vertical;
      min-height: 120px;
    }

    button {
      padding: 0.8rem;
      background-color: #ff4d4d;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 80%;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .guestbook-form-container button[type="submit"] {
      background-color: #fff;
      color: #000;
      border: 1px solid #000;
    }
    .guestbook-form-container button[type="submit"]:hover {
      background-color: #000; /* invert on hover */
      color: #fff;
      border-color: #000;
    }

    button:hover {
      background-color: #e60000;
    }

    .message {
      background: white;
      border-radius: 10px;
      color: black;
      font-weight: 500;
      padding: 0.75rem 1rem; /* roomier */
      margin: 0;
      flex: 0 0 calc((100% - 2rem) / 3);
      box-sizing: border-box;
      display: block;
      position: relative;
      min-height: 72px; /* not too short */
      align-self: flex-start;
    }

    .message-list {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: flex-start;
      align-items: flex-start;
      align-content: flex-start;
    }


    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.25rem;          /* tighter spacing */
      margin-top: 1rem;
      line-height: 1;
      margin-bottom: 8px;
    }
    .pagination .page-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      font-weight: 700;
      color: #aaa;
      background: transparent;
      cursor: pointer;
      user-select: none;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    .pagination .page-link.active {
      background: #ff4d4d; /* red background */
      color: #fff;
    }
    .pagination .page-link:hover:not(.active) {
      background: rgba(255,77,77,0.1);
      color: #ff4d4d;
    }

    .hidden {
      display: none;
    }

    /* Two-column layout */
    .guestbook-left {
      flex: 0 0 40%;
      display: flex;
      flex-direction: column;
      align-self: flex-start;
      position: sticky;
      top: 120px; /* keep previous spacing under 90px header */
    }
    .guestbook-right { flex: 1 1 60%; max-width: 700px; }

    /* Title block on the left */
    .guestbook-left h1 { 
      font-family: 'Times New Roman', serif;
      font-size: 4.5rem;
      color: #fff;
      margin: 36px 0 12px 0; /* moved further down */
    }
    .guestbook-left p { color: #ddd; margin: 0; }

    /* Form + inputs on the left (equal widths) */
    .guestbook-left .write-button-wrapper { text-align: left; margin-bottom: 16px; }
    .guestbook-left .guestbook-form-container {
      margin-top: 16px; /* keep small gap, no push to bottom */
      margin-bottom: 20px;
    }
    .guestbook-left form { display: flex; flex-direction: column; gap: 12px; max-width: 520px; }
    .guestbook-left input[type="text"],
    .guestbook-left textarea,
    .guestbook-left button[type="submit"],
    .guestbook-left #toggleWriteForm {
      width: 100%;
      box-sizing: border-box;
    }

    /* Message list lives on the right */
    .guestbook-right .message-list { justify-content: flex-start; }

    /* === Guest message edit UI === */
    .message .msg-actions {
      position: absolute;
      top: 8px;
      right: 8px;
      display: none; /* hidden until pencil clicked */
      gap: .35rem;
      margin: 0;
    }
    .message .msg-actions button {
      background: #222;
      color: #fff;
      border: 1px solid #444;
      padding: .28rem .48rem;
      border-radius: 6px;
      font-size: .78rem;
      cursor: pointer;
    }
    .message .msg-actions button:hover { background:#333; }
    .message.show-actions .msg-actions { display: flex; }
    .message .edit-toggle {
      position: absolute; top: 8px; right: 8px;
      background: transparent; border: 0; cursor: pointer;
      font-size: 18px; line-height: 1; padding: 2px; color: #555;
    }
    .message .edit-toggle:hover { color: #000; }
    .message .edit-form {
      display:flex;
      flex-direction:column;
      gap:.6rem;
    }
    .message .edit-form input[type="text"],
    .message .edit-form textarea {
      width:100%;
      box-sizing:border-box;
      border:1px solid #bbb;
      border-radius:8px;
      padding:.6rem .7rem;
      font-size: .95rem;
      background:#fafafa;
      color:#111;
    }
    .message .edit-form textarea { min-height: 80px; resize: vertical; }

    /* Guest message text: clamp to 2 lines by default, no inner scroll */
    .message p.msg-text {
      line-height: 1.45;
      margin: 0;
      color: #000;
      background: transparent;
      font-size: 1rem;
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      line-clamp: 2;
      max-height: calc(1.45em * 2);
      white-space: normal;
    }


    /* Saved message layout: To â†’ Message â†’ From */
    .message .kv { display:flex; flex-direction:column; gap:.3rem; }
    .message .kv .row { display:flex; flex-direction:column; gap:.1rem; }
    .message .kv .label { font-size:.85rem; font-weight:700; color:#666; letter-spacing:.2px; }
    .message .kv .value { font-size:1rem; font-weight:700; color:#111; }
    .message .kv .msg-text { margin-top:0; }
    .message .kv .row.message .label { display:none; }


    @media (max-width: 900px) {
      .guestbook-container { flex-direction: column; gap: 24px; }
      .guestbook-left, .guestbook-right { flex: 1 1 auto; max-width: 100%; }
    }

.guestbook-right {
  flex: 1 1 auto;
  max-width: 700px;
  display: flex;
  flex-direction: column;
  min-height: 0; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ í—ˆìš© */
}

.message-list {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: flex-start;
  flex: 1 1 auto;       /* ë‚¨ì€ ê³µê°„ ì „ë¶€ ì°¨ì§€ */
  min-height: 0;
  padding-bottom: calc(var(--footer-safe) + 104px);
  overflow: visible;    /* ë¦¬ìŠ¤íŠ¸ ìì²´ ìŠ¤í¬ë¡¤ ì œê±° â†’ í˜ì´ì§€ê°€ ìŠ¤í¬ë¡¤ */
  align-items: flex-start;
  align-content: flex-start;
}

#pagination{
  position: fixed;
  left: 50%;
  bottom: calc(var(--footer-safe) + 0px);
  transform: translateX(-50%);
  z-index: 10;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  padding: 6px 10px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.25);
}

/* Restore compact spacing: Pager is not fixed, so minimal bottom padding is sufficient */



    /* ===== Project list: equal-sized tiles ===== */
.project ul,
.projects ul,
.project-list { 
  display: grid; 
  grid-template-columns: repeat(3, minmax(0, 1fr)); 
  gap: 16px; 
  list-style: none; 
  padding: 0; 
  margin: 0; 
}

.project ul li,
.projects ul li,
.project-list li {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid #333;
  border-radius: 12px;
  background: #111;
  color: #fff;
  overflow: hidden;
  /* Make every tile the exact same size */
  aspect-ratio: 1 / 1;          /* perfect square */
  min-height: 180px;            /* floor for very narrow screens */
}

/* If an image or thumbnail exists inside li, make it fit uniformly */
.project ul li img,
.projects ul li img,
.project-list li img {
  width: 100%;
  height: 100%;
  object-fit: cover;   /* consistent crop */
  display: block;
}

/* Optional inner content wrapper support */
.project ul li > a,
.projects ul li > a,
.project-list li > a,
.project ul li > .card,
.projects ul li > .card,
.project-list li > .card {
  position: absolute; inset: 0; 
  display: flex; align-items: center; justify-content: center; 
  text-decoration: none; color: inherit;
  padding: 12px;
}

/* Responsive columns */
@media (max-width: 1000px) {
  .project ul, .projects ul, .project-list { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 560px) {
  .project ul, .projects ul, .project-list { grid-template-columns: 1fr; }
}

    /* Stick footer to the bottom of the viewport, full-width */
    #footer-placeholder {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000; /* above pager */
      width: 100%;
    }
    #footer-placeholder footer,
    #footer-placeholder .footer,
    #footer-placeholder .site-footer { position: relative; z-index: 1000; }

/* Keep existing look & feel for buttons */
#pagination .page-link.active { background: #ff4d4d; color: #fff; }
#pagination .page-link:hover:not(.active) { background: rgba(255,77,77,0.1); color: #ff4d4d; }

/* Mobile tweak: nudge up a little on very short screens */
@media (max-height: 620px) {
  #pagination { bottom: calc(var(--footer-safe) + 0px); }
}

  </style>
</head>
<body>
  <div class="page-wrapper">
    <div id="nav-placeholder"></div>
    <div id="cursor-placeholder"></div>
    <main class="content">
      <div class="guestbook-container">
        <div class="guestbook-left">
          <h1 class="page-title guestbook-title">GUEST BOOK</h1>
          <div class="write-button-wrapper">
            <button id="toggleWriteForm">âœ ê¸€ì“°ê¸°</button>
          </div>
          <div class="guestbook-form-container hidden">
            <form id="guestForm" name="guestbook" method="POST" data-netlify="true" netlify-honeypot="bot-field">
              <input type="hidden" name="form-name" value="guestbook" />
              <input type="text" id="name" name="name" placeholder="To" required />
              <textarea id="message" name="message" placeholder="ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”" required></textarea>
              <input type="text" id="from" name="from" placeholder="From" required />
              <input class="hidden" type="text" name="bot-field" tabindex="-1" autocomplete="off" />
              <button type="submit">ë‚¨ê¸°ê¸°</button>
            </form>
          </div>
        </div>
        <div class="guestbook-right">
          <div class="message-list" id="messageList"></div>
          <div class="pagination" id="pagination"></div>
        </div>
      </div>
    </main>
    <div id="footer-placeholder"></div>
  </div>
  <form name="guestbook" method="POST" data-netlify="true" netlify-honeypot="bot-field" style="position:absolute;left:-9999px;opacity:0;pointer-events:none;">
    <input type="hidden" name="form-name" value="guestbook" />
    <input name="name" />
    <textarea name="message"></textarea>
    <input name="from" />
    <input type="text" name="bot-field" />
    <button type="submit">ë‚¨ê¸°ê¸°</button>
  </form>
  <script> 
    // ë„¤ë¹„ê²Œì´ì…˜ HTML ë¡œë“œ (Project.page ìŠ¤íƒ€ì¼ ìš°ì„  ì ìš©) + ë¡œê³  êµì²´ + ë§í¬ ì •ê·œí™”
    (async function loadProjectNav(){
      const root = document.getElementById('nav-placeholder');
      if (!root) return;
      const basePath = '../../2.PageElement/Tob_nav/';
      const candidates = [
        basePath + 'Tob_nav_project.html', // Project í˜ì´ì§€ì™€ ë™ì¼ ë„¤ë¹„ ìš°ì„ 
        basePath + 'Tob_nav.html'          // ì—†ìœ¼ë©´ ê¸°ë³¸ ë„¤ë¹„ ì‚¬ìš©
      ];
      let html = '';
      for (const url of candidates){
        try{
          const res = await fetch(url, { cache: 'no-store' });
          if (res.ok){ html = await res.text(); break; }
        }catch(_){ /* try next */ }
      }
      if (!html){ console.warn('[guest] nav load failed'); return; }

      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // ë¡œê³  ì´ë¯¸ì§€ êµì²´ (ì¥ë¯¸ë¡œê³  + í…ìŠ¤íŠ¸ ë¡œê³ )
      const logoContainer = doc.querySelector('.logo');
      if (logoContainer) {
        const imgs = logoContainer.querySelectorAll('img');
        if (imgs.length > 0) {
          imgs[0].outerHTML = '<img src="../../1.Picture/1.%2027th%20Graduation/BLOOM_LOGO/1.png" alt="ì¥ë¯¸ë¡œê³ " />';
          if (imgs.length > 1) {
            imgs[1].setAttribute('src', '../../1.Picture/1.%2027th%20Graduation/BLOOM_LOGO/BLOOM_LOGOTAXT.png');
          }
        }
      }

      // base íƒœê·¸ ì œê±° (ìƒëŒ€ê²½ë¡œ ê¼¬ì„ ë°©ì§€)
      const baseEl = doc.querySelector('base');
      if (baseEl) baseEl.remove();

      // ë§í¬ ì •ê·œí™”: í˜„ì¬ ë””ë ‰í† ë¦¬(/2025) ê¸°ì¤€ìœ¼ë¡œ ë§¤í•‘
      const baseDir = location.pathname.replace(/\/[^/]*$/, '');
      const toURL = (file) => `${baseDir}/${file}`.replace(/\/{2,}/g, '/');
      const linkMap = {
        'home': toURL('Main.html'),
        'about': toURL('About.html'),
        'project': toURL('Project.html'),
        'designer': toURL('Designer.html'),
        'guest': toURL('Guest.html'),
        'guest book': toURL('Guest.html'),
        'guestbook': toURL('Guest.html'),
      };

      const logoLink = doc.querySelector('a.logo, .logo a');
      if (logoLink) logoLink.setAttribute('href', linkMap['home']);

      doc.querySelectorAll('a[href]').forEach(a => {
        const text = (a.textContent || '').trim().toLowerCase();
        const href = (a.getAttribute('href') || '').trim();
        if (linkMap[text]) { a.setAttribute('href', linkMap[text]); return; }
        if (/about/i.test(href))          a.setAttribute('href', linkMap['about']);
        else if (/project/i.test(href))   a.setAttribute('href', linkMap['project']);
        else if (/designer/i.test(href))  a.setAttribute('href', linkMap['designer']);
        else if (/guest(\s*book)?/i.test(href)) a.setAttribute('href', linkMap['guest']);
        else if (/main|home|index/i.test(href))  a.setAttribute('href', linkMap['home']);
      });

      // í˜„ì¬ í˜ì´ì§€ í™œì„±í™” í‘œì‹œ
      const currentName = location.pathname.split('/').pop().toLowerCase();
      doc.querySelectorAll('a[href]').forEach(a => {
        const target = (a.getAttribute('href') || '').toLowerCase();
        if (target.endsWith(currentName)) {
          a.setAttribute('aria-current', 'page');
          a.classList.add('is-active');
        }
      });

      // DOMì— ì‚½ì…
      root.innerHTML = doc.body.innerHTML;

      // Remove dropdown structures from the injected navigation
      (function stripDropdowns(){
        const navRoot = document.getElementById('nav-placeholder');
        if (!navRoot) return;
        // Remove submenu <ul>s
        navRoot.querySelectorAll('nav ul ul, .dropdown, .submenu, .menu .sub, [aria-haspopup="true"] > ul').forEach(el=>{
          try{ el.remove(); }catch(_){ el.parentNode && el.parentNode.removeChild(el); }
        });
        // Remove dropdown indicator classes to avoid CSS hooks
        navRoot.querySelectorAll('.has-dropdown, .has-children, .dropdown-toggle').forEach(el=>{
          el.classList.remove('has-dropdown','has-children','dropdown-toggle');
          el.removeAttribute('aria-haspopup');
          el.removeAttribute('aria-expanded');
        });
      })();


      // --- ë„¤ë¹„ ë†’ì´ë§Œí¼ ìŠ¤í˜ì´ì„œ í™•ë³´ (ê²¹ì¹¨ ë°©ì§€) ---
      (function syncNavSpacer(){
        const root = document.getElementById('nav-placeholder');
        if (!root) return;
        let spacer = document.querySelector('.nav-spacer');
        if (!spacer) {
          spacer = document.createElement('div');
          spacer.className = 'nav-spacer';
          root.after(spacer);
        }
        let header = root.querySelector('header') || root.firstElementChild;
        function setSpacer(){
          const ref = header || root.firstElementChild;
          if (ref && spacer){ spacer.style.height = (ref.offsetHeight + 8) + 'px'; }
        }
        setSpacer();
        window.addEventListener('resize', setSpacer, { passive:true });
        setTimeout(setSpacer, 150);
        setTimeout(setSpacer, 600);
        try {
          const ro = new ResizeObserver(setSpacer);
          if (header) ro.observe(header);
          const mo = new MutationObserver(()=>{ header = root.querySelector('header') || root.firstElementChild; setSpacer(); });
          mo.observe(root, { childList:true, subtree:true, attributes:true });
        } catch(_) {}
        console.debug('[guest] nav spacer synced');
      })();

      // --- ìŠ¤í¬ë¡¤ ë‚´ë¦´ ë•Œ ìˆ¨ê¸°ê³  ì˜¬ë¦¬ë©´ ë³´ì´ê¸° ---
      console.debug('[guest] hide-on-scroll binding');
      (function hideNavOnScroll(){
        if (window.__navHideBound) return;
        window.__navHideBound = true;
        let prevY = window.pageYOffset || 0;
        window.addEventListener('scroll', function(){
          const y = window.pageYOffset || 0;
          if (y > prevY + 8 && y > 40) document.body.classList.add('nav-hidden');
          else if (y < prevY - 8) document.body.classList.remove('nav-hidden');
          prevY = y;
        }, { passive:true });
      })();
    })();
    // í‘¸í„° HTML ë¡œë“œ + ê³ ì • í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì•ˆì „ ì—¬ë°± ê³„ì‚°
    fetch('../../2.PageElement/Footer/Footer.html')
      .then(res => res.text())
      .then(data => {
        const root = document.getElementById('footer-placeholder');
        if (root) root.innerHTML = data;

        const setFooterSafe = () => {
          const h = root.offsetHeight || 0;
          document.documentElement.style.setProperty('--footer-safe', h + 'px');
        };
        setFooterSafe();

        const ro = new ResizeObserver(setFooterSafe);
        ro.observe(root);
        window.addEventListener('resize', setFooterSafe, { passive: true });
      });

    // ì»¤ì„œ HTML ì‚½ì… + ì´ˆê¸°í™” (ë¶€ë“œëŸ¬ìš´ ì¶”ì )
    (function loadCursor(){
      const root = document.getElementById('cursor-placeholder');
      if (!root) return;

      function initRoseCursor(){
        const cursor = document.querySelector('.cursor-dot');
        if (!cursor) return false;
        // ì¤‘ë³µ RAF ë°©ì§€ (ì¬ì´ˆê¸°í™” ì‹œ ë£¨í”„ ì¤‘ì²© ë°©ì§€)
        if (cursor.dataset.raf === 'on') return true;

        // ì„±ëŠ¥ íŒíŠ¸: transform ì—…ë°ì´íŠ¸ ê°€ì†
        cursor.style.willChange = 'transform';

        let x = 0, y = 0, tx = 0, ty = 0, started = false;
        const ease = 0.62; // â†‘ ê°’ì´ í´ìˆ˜ë¡ ë” ë¹ ë¥´ê²Œ ë”°ë¼ì˜´ (ê¸°ì¡´ 0.25)

        function raf(){
          tx += (x - tx) * ease;
          ty += (y - ty) * ease;
          cursor.style.transform = `translate3d(calc(${tx}px - 50%), calc(${ty}px - 50%), 0)`;
          requestAnimationFrame(raf);
        }

        document.addEventListener('mousemove', (e)=>{
          x = e.clientX; y = e.clientY;
          if (!started){ tx = x; ty = y; started = true; }
        }, {passive:true});

        cursor.dataset.raf = 'on';
        requestAnimationFrame(raf);
        return true;
      }

      fetch('../../2.PageElement/Cursor/cursor.html', {cache: 'no-store'})
        .then(res => res.text())
        .then(html => {
          root.innerHTML = html;
          if (!initRoseCursor()) {
            const mo = new MutationObserver(()=>{ if (initRoseCursor()) mo.disconnect(); });
            mo.observe(root, {childList:true, subtree:true});
          }
        })
        .catch(err => console.error('Cursor load failed:', err));
    })();

    const messagesPerPage = 6; // 3 columns x 2 rows per page
    let messages = [];
    let currentPage = 1;

    // --- helpers to avoid HTML injection when rendering user text ---
    function escHtml(str){
      return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }
    function escAttr(str){ return escHtml(str); }

    function renderMessages() {
      const messageList = document.getElementById("messageList");
      const pagination = document.getElementById("pagination");
      // Hide pager when there are no messages; show when messages exist
      if (messages.length === 0) {
        messageList.innerHTML = "";
        pagination.innerHTML = "";
        pagination.classList.add("hidden");
      } else {
        pagination.classList.remove("hidden");
      }
      messageList.innerHTML = "";
      pagination.innerHTML = "";

      const start = (currentPage - 1) * messagesPerPage;
      const end = start + messagesPerPage;
      const paginatedItems = messages.slice(start, end);

      paginatedItems.forEach((item, iLocal) => {
        const idx = start + iLocal;
        const { name, message, editing } = item;
        const msgDiv = document.createElement("div");
        msgDiv.classList.add("message");

        if (editing) {
          msgDiv.innerHTML = `
            <form class="edit-form" data-index="${idx}">
              <input type="text" id="edit-name-${idx}" value="${escAttr(name)}" placeholder="To" required />
              <input type="text" id="edit-from-${idx}" value="${escAttr(item.from || '')}" placeholder="From" required />
              <textarea id="edit-message-${idx}" required>${escHtml(message)}</textarea>
              <div class="msg-actions">
                <button type="submit" class="save-btn">ì €ì¥</button>
                <button type="button" class="cancel-btn">ì·¨ì†Œ</button>
                <button type="button" class="delete-btn" data-index="${idx}">ì‚­ì œ</button>
              </div>
            </form>
          `;
        } else {
          const safeName = escHtml(name);
          const safeMsg = escHtml(message).replace(/\n/g,'<br>');
          msgDiv.innerHTML = `
  <button class="edit-toggle" aria-label="ìˆ˜ì • ë©”ë‰´ ì—´ê¸°">âœï¸</button>
  <div class="kv">
    <div class="row to"><span class="label">To</span><span class="value">${safeName}</span></div>
    <div class="row message"><span class="label">Message</span><p class="msg-text">${safeMsg}</p></div>
    <div class="row from"><span class="label">From</span><span class="value">${escHtml(item.from || safeName)}</span></div>
  </div>
  <div class="msg-actions">
    <button class="edit-btn" data-index="${idx}">ìˆ˜ì •</button>
    <button class="delete-btn" data-index="${idx}">ì‚­ì œ</button>
  </div>`;
        }

        messageList.appendChild(msgDiv);
      });

      const pageCount = Math.max(1, Math.ceil(messages.length / messagesPerPage));
      for (let i = 1; i <= pageCount; i++) {
        const link = document.createElement("span");
        link.className = "page-link" + (i === currentPage ? " active" : "");
        link.textContent = i;
        link.addEventListener("click", () => {
          currentPage = i;
          renderMessages();
        });
        pagination.appendChild(link);
        if (i < pageCount) {
          const sep = document.createElement("span");
          sep.className = "page-sep";
          sep.textContent = "Â·";
          sep.style.margin = "0 .1rem";
          sep.style.opacity = "0.6";
          pagination.appendChild(sep);
        }
      }
      document.documentElement.style.setProperty('--footer-safe', (document.getElementById('footer-placeholder').offsetHeight || 0) + 'px');
    }

    document.getElementById("guestForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.currentTarget;
      const formData = new FormData(form);
      // Netlify requires the `form-name` key in the encoded body
      if (!formData.get("form-name")) formData.set("form-name", "guestbook");

      // Encode as application/x-www-form-urlencoded
      const body = new URLSearchParams();
      for (const [k, v] of formData.entries()) body.append(k, v);

      try {
        await fetch("/", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: body.toString()
        });

        const name = formData.get("name");
        const message = formData.get("message");
        const from = formData.get("from");

        // Optimistic UI + local cache as fallback
        messages.unshift({ name, message, from });
        try {
          const cached = JSON.parse(localStorage.getItem("guestbook-cache") || "[]");
          cached.unshift({ name, message, from, _ts: Date.now() });
          localStorage.setItem("guestbook-cache", JSON.stringify(cached.slice(0, 200)));
        } catch (_) {}

        currentPage = 1;
        renderMessages();
        form.reset();
        alert("ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!.");
      } catch (err) {
        console.error("Netlify submit failed", err);
        alert("ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      }
    });

    document.getElementById("toggleWriteForm").addEventListener("click", function () {
      const formContainer = document.querySelector(".guestbook-form-container");
      formContainer.classList.toggle("hidden");
    });

    // --- delegated edit/delete handlers on the message list ---
    document.getElementById('messageList').addEventListener('click', (e) => {
      const editBtn = e.target.closest('.edit-btn');
      const cancelBtn = e.target.closest('.cancel-btn');
      const delBtn = e.target.closest('.delete-btn');
      const toggleBtn = e.target.closest('.edit-toggle');
      if (toggleBtn) {
        const card = toggleBtn.closest('.message');
        if (card) card.classList.toggle('show-actions');
        return;
      }
      if (editBtn) {
        const idx = parseInt(editBtn.dataset.index, 10);
        if (!isNaN(idx) && messages[idx]) {
          messages[idx].editing = true;
          renderMessages();
        }
        return;
      }
      if (cancelBtn) {
        const form = e.target.closest('.edit-form');
        const idx = form ? parseInt(form.dataset.index, 10) : -1;
        if (!isNaN(idx) && messages[idx]) {
          messages[idx].editing = false;
          renderMessages();
        }
        return;
      }
      if (delBtn) {
        const idx = parseInt(delBtn.dataset.index, 10);
        if (!isNaN(idx) && messages[idx]) {
          if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ì–´ìš”?')) {
            messages.splice(idx, 1);
            // ğŸ”„ ë¡œì»¬ ìºì‹œë„ í˜„ì¬ messages ë°°ì—´ë¡œ ë™ê¸°í™”
            try {
              const toCache = messages.map(({ name, message, from }) => ({ name, message, from, _ts: Date.now() }));
              localStorage.setItem('guestbook-cache', JSON.stringify(toCache));
            } catch (_) {}
            const maxPage = Math.ceil(messages.length / messagesPerPage) || 1;
            if (currentPage > maxPage) currentPage = maxPage;
            renderMessages();
          }
        }
        return;
      }
    });
    

    document.getElementById('messageList').addEventListener('submit', (e) => {
      const form = e.target.closest('.edit-form');
      if (!form) return;
      e.preventDefault();
      const idx = parseInt(form.dataset.index, 10);
      if (isNaN(idx) || !messages[idx]) return;
      const newName = document.getElementById(`edit-name-${idx}`).value;
      const newFrom = document.getElementById(`edit-from-${idx}`).value;
      const newMsg  = document.getElementById(`edit-message-${idx}`).value;
      messages[idx] = { name: newName, from: newFrom, message: newMsg, editing: false };
      renderMessages();
      try {
        const toCache = messages.map(({ name, message, from }) => ({ name, message, from, _ts: Date.now() }));
        localStorage.setItem('guestbook-cache', JSON.stringify(toCache));
      } catch (_) {}
    });

    async function loadInitialMessages(){
      // 1) Try server endpoint (you will add a Netlify Function named `guestbook` that returns JSON)
      try {
        const res = await fetch("/api/guestbook", { cache: "no-store" });
        if (res.ok) {
          const rows = await res.json();
          // Expecting an array of { name, message, from }
          messages = Array.isArray(rows) ? rows.map(r => ({
            name: r.name || "",
            message: r.message || "",
            from: r.from || (r.name || ""),
          })) : [];
          currentPage = 1;
          renderMessages();
          return;
        }
      } catch(_) { /* ignore and try local */ }

      // 2) Fallback: local cache so at least this device keeps messages
      try {
        const cached = JSON.parse(localStorage.getItem("guestbook-cache") || "[]");
        messages = cached.map(r => ({ name: r.name, message: r.message, from: r.from }));
      } catch(_) { messages = []; }
      currentPage = 1;
      renderMessages();
    }

    // Replace the original direct call
    loadInitialMessages();
    // --- í™”ë©´ í¬ê¸° ë³€í™” ì‹œ ëª¨ë°”ì¼ í˜ì´ì§€ë¡œ ìë™ ì „í™˜ ---
    (function handleResponsiveRedirect(){
      function checkViewport() {
        const width = window.innerWidth;
        const current = location.pathname.toLowerCase();
        if (width < 800 && !current.includes('guest-mobile.html')) {
          location.href = 'Guest-mobile.html';
        }
      }
      window.addEventListener('resize', checkViewport);
      window.addEventListener('load', checkViewport);
    })();
  </script>
</body>
</html>
    /* ëª¨ë°”ì¼(800px ì´í•˜)ì—ì„œ guestbook-title ì¤‘ì•™ì •ë ¬ ë° ìŠ¤íƒ€ì¼ ì ìš© */
    @media (max-width: 800px) {
      .guestbook-title {
        text-align: center;
        margin: 0 auto 1.5rem auto;
        font-size: 3rem;
      }
    }