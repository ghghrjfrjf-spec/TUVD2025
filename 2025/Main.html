<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TUVD 27th Graduate Exhibition - BLOOM</title>
  <!-- 🔺 스타일시트 연결 -->
  <!-- // 네비게이션 스타일 -->
  <link rel="stylesheet" href="../../2.PageElement/Tob_nav/Tob_nav.css" />
  <!-- // 푸터 스타일 -->
  <link rel="stylesheet" href="../../2.PageElement/Footer/Footer.css" />
  <!-- // 커서 스타일 -->
  <link rel="stylesheet" href="../../2.PageElement/Cursor/cursor.css" />
  <style>
    /* 장미 커서 기본 스타일( .cursor-dot / .rose-cursor 공통 ) */
    .cursor-dot, .rose-cursor, [data-rose-cursor]{
      position: fixed;
      left: -100px; top: -100px;         /* offscreen until first move */
      transform: translate3d(-9999px, -9999px, 0); /* moved offscreen until we know size */
      transform-origin: 50% 50%; /* center by default; JS will set exact px hotspot */
      pointer-events: none;               /* never block clicks */
      z-index: 99999;                     /* above everything */
      will-change: transform;             /* GPU hint for smoothness */
    }
    :root{ --nav-safe: 0px; --line: rgba(255,255,255,.12); }

    #nav-placeholder{
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: transform 0.6s ease-in-out; /* 시간 늘리고 부드러운 곡선 적용 */
      will-change: transform;
    }

    /* 헤더 비주얼: 반투명 블랙 + 블러 + 얇은 구분선 */
    #nav-placeholder header{
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,.12);
      box-sizing: border-box;
      width: 100%;
      height: 90px;
      padding-left: 59px;
      padding-right: 60px;
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
      transition: transform .38s cubic-bezier(.22,.61,.36,1), box-shadow .24s ease;
    }

    /* 로고 크기 조정 */
    #nav-placeholder header .logo img{
      max-height: 38px;
      transform: translateY(2px);
    }

    #nav-placeholder .logo .logo-main{ font-size: 15px !important; }
    #nav-placeholder .logo .logo-sub { font-size: 15px !important; }


    /* 네비 링크 타이포그래피 */
    #nav-placeholder header a{
      font-family: 'Pretendard', sans-serif;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .2px;
      text-decoration: none;
      color: #fff;
      padding: 8px 0;
    }
    
    #nav-placeholder header a:hover{ color:#ff3b3b; }
    #nav-placeholder header a.is-active{ color:#ff4d4d; font-weight:700; }

    #nav-placeholder nav ul{
      display: flex;
      align-items: center;       /* 세로 가운데 정렬 */
      gap: 47px;                 /* Project 페이지 간격과 동일하게 */
      list-style: none;
      margin: 0;
      padding: 0;
    }

    /* 스크롤 시 네비게이션 숨김 */
    body.nav-hidden #nav-placeholder,
    body.nav-hidden #nav-placeholder > header {
      transform: translateY(-110%) !important;
    }
    
    /* 전체 화면 레이아웃 + 푸터 하단 고정 */
    html, body { background:#000; }
    .page { background:#000; width:100%; }
    
    /* 포스터: 자르지 않고 화면에 맞춰 표시 */
    .poster-stage{
      /* 이미지가 끝나면 바로 푸터가 닿도록: 그리드/센터링 제거 */
      display:block;
      background:#000;
      padding:var(--nav-safe) 0 0 0;
      box-sizing:border-box;
      overflow:hidden;
      width:100%;
      line-height:0; /* 인라인 공백 제거(혹시 모를 갭 방지) */
    }
    .poster-stage .poster-horizontal{
      margin: -50px auto 0; /* 위로 50px, 좌우 중앙 정렬, 하단 여백 0 */
      max-width:100%;   /* 스테이지 너비를 넘지 않음 */
      height:auto;      /* 비율 유지 */
      display:block;
    }
    .poster-stage{ padding-bottom:0; margin-bottom:0; }
    .poster-stage .poster-horizontal{ margin-bottom:0; }

    /* 컨텐츠가 짧아도 푸터가 하단에 머무르도록 */
    #footer-placeholder { margin-top:0; background:#000; }

    /* 맨 위로 버튼: 항상 최상단 표시 */
    .scroll-btn{
      position:fixed;
      right:16px;
      bottom:16px;
      z-index:99999; /* 맨 위 */
      display:none;
      align-items:center;
      justify-content:center;
      width:44px; height:44px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      background:#000;
      color:#fff; font-weight:900; letter-spacing:.3px;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .scroll-btn:hover{ border-color:#ff3b3b; box-shadow:0 6px 22px rgba(255,59,59,.25); }

    
    footer, .site-footer, #footer{
      position:relative !important; /* 이미지 위로 겹치지 않음 */
      width:100%;
      background:#000 !important;
      border-top:1px solid var(--line);
      z-index: 1;
    }

  </style>
</head>


<body>
  <!-- 
    // 본문 주요 섹션 안내
    // 1) #nav-placeholder : 네비게이션
    // 2) #cursor-placeholder : 커서
    // 3) .poster-stage : 메인 포스터 영역
    // 4) #footer-placeholder : 푸터
  -->
  <div class="page">
    <!-- 🔺 네비게이션 영역 -->
    <div id="nav-placeholder"></div>
    <div id="cursor-placeholder"></div>

    <!-- 🔻 전시 정보: 화면에 딱 맞게 포스터 표시 -->
    <div class="poster-stage">
      <img class="poster-horizontal" src="../../1.Picture/1. 27th Graduation/BLOOM_Poster/가로.jpg" alt="가로" loading="lazy" />
    </div>
    

    <!-- 🔻 푸터 영역 -->
    <div id="footer-placeholder"></div>
  </div>

  <!-- Scroll to Top Button -->
  <button onclick="scrollToTop()" id="scrollTopBtn" class="scroll-btn">▲</button>

  
  <!-- 📜 JavaScript -->
  <script>
    // [네비게이션] 경로 후보(우선: Tob_nav_project.html → 실패 시 Tob_nav.html)
    const __navPaths = [
      '../../2.PageElement/Tob_nav/Tob_nav.html'
    ];
    
    
    // [네비게이션] HTML 가져오기(fetch) - 실패 시 다음 후보로 재귀 시도
    function fetchNav(paths){
      const [first, ...rest] = paths;
      return fetch(first, { cache: 'no-store' }).then(r => {
        if (!r.ok) throw new Error('HTTP ' + r.status);
        return r.text();
      }).catch(err => {
        if (!rest.length) throw err;
        return fetchNav(rest);
      });
    }

    // [네비게이션] 주입 +  링크 정규화 + 네비 높이 보정(--nav-safe)
    fetchNav(__navPaths)
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        // 링크 정규화: 현재 디렉토리(/2025) 기준으로 매핑
        const baseDir = location.pathname.replace(/\/[^/]*$/, '');
        const toURL = (file) => `${baseDir}/${file}`.replace(/\/{2,}/g, '/');
        const linkMap = {
          'home': toURL('Main.html'),
          'about': toURL('About.html'),
          'project': toURL('Project.html'),
          'designer': toURL('Designer.html'),
          'guest': toURL('Guest.html'),
          'guest book': toURL('Guest.html'),
          'guestbook': toURL('Guest.html'),
        };

        doc.querySelectorAll('a[href]').forEach(a => {
          const text = (a.textContent || '').trim().toLowerCase();
          const href = (a.getAttribute('href') || '').trim();
          if (linkMap[text]) { a.setAttribute('href', linkMap[text]); return; }
          if (/about/i.test(href))          a.setAttribute('href', linkMap['about']);
          else if (/project/i.test(href))   a.setAttribute('href', linkMap['project']);
          else if (/designer/i.test(href))  a.setAttribute('href', linkMap['designer']);
          else if (/guest(\s*book)?/i.test(href)) a.setAttribute('href', linkMap['guest']);
          else if (/main|home|index/i.test(href))  a.setAttribute('href', linkMap['home']);
        });


        // 헤더만 주입 (불필요한 래퍼 제거)
        const headerEl = doc.querySelector('header');
        const navRoot = document.getElementById('nav-placeholder');
        if (navRoot && headerEl) {
          navRoot.innerHTML = '';
          navRoot.appendChild(headerEl);
        }

        // 네비 높이만큼 스페이서/안전여백 확보 (포스터가 가려지지 않게)
        (function syncNavOffset(){
          function setSafe(){
            const header = document.querySelector('#nav-placeholder header');
            const h = header ? header.offsetHeight : 0;
            document.documentElement.style.setProperty('--nav-safe', h + 'px');
          }
          setSafe();
          window.addEventListener('resize', setSafe, { passive:true });
          setTimeout(setSafe, 150);
          setTimeout(setSafe, 600);
        })()});

    // [커서] 장미 커서 로드 및 스프링 모션 적용
    (function loadCursor(){
      const root = document.getElementById('cursor-placeholder');
      if (!root) return;

      function initRoseCursor(){
        // #cursor-placeholder 내부에 주입된 커서 요소만 사용
        const el = document.querySelector('#cursor-placeholder .cursor-dot, #cursor-placeholder .rose-cursor, #cursor-placeholder [data-rose-cursor]');
        if (!el) return false;
        if (el.dataset.raf === 'on') return true; // prevent double-binding

        // 기본 스타일
        el.style.pointerEvents = 'none';
        el.style.position = 'fixed';
        el.style.zIndex = '99999';
        el.style.willChange = 'transform, opacity';
        el.style.left = '0px';
        el.style.top  = '0px';

        // 사용자가 모션 축소를 선호하면 즉시 추종 모드로 전환
        try{
          const prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (prefersReduce){
            document.addEventListener('mousemove', (e)=>{
              el.style.transform = `translate3d(${e.clientX}px, ${e.clientY}px, 0)`;
              el.style.opacity = '1';
            }, { passive:true });
            return true;
          }
        }catch(_){ /* ignore */ }

        // 마우스 좌표(목표)와 현재 좌표(프록시) 및 속도
        let x = 0, y = 0;   // target (mouse)
        let px = 0, py = 0; // current (proxy)
        let vx = 0, vy = 0; // velocity (for spring)
        // 스프링 파라미터 (더 빠르고 경쾌하게)
        const STIFF = 0.20; // 강성 ↑ : 더 빨리 목표를 따라감
        const DAMP  = 0.88; // 감쇠 ↓ : 반응성 향상(잔떨림은 적당히 유지)

        // 앵커/핫스팟 지원
        // - data-hotspot-x / data-hotspot-y(px)가 있으면 그대로 사용
        // - 없으면 data-anchor-x / data-anchor-y(0~1 비율, 기본 0.5, 0.5) 사용
        const hotspotX = parseFloat(el.getAttribute('data-hotspot-x'));
        const hotspotY = parseFloat(el.getAttribute('data-hotspot-y'));

        let anchorX = parseFloat(el.getAttribute('data-anchor-x'));
        let anchorY = parseFloat(el.getAttribute('data-anchor-y'));
        if (!isFinite(anchorX)) anchorX = 0.5;
        if (!isFinite(anchorY)) anchorY = 0.5;

        // 선택: 페이지별 픽셀 보정(시스템 커서 위치와 정확히 맞춤)
        const calXAttr = parseFloat(el.getAttribute('data-cal-x'));
        const calYAttr = parseFloat(el.getAttribute('data-cal-y'));
        const CALX = Number.isFinite(calXAttr) ? calXAttr : 0;
        const CALY = Number.isFinite(calYAttr) ? calYAttr : 0;

        let offX = 0, offY = 0;
        const updateOffset = () => {
          const r = el.getBoundingClientRect();
          const w = r.width  || el.offsetWidth  || 0;
          const h = r.height || el.offsetHeight || 0;
          offX = isFinite(hotspotX) ? hotspotX : w * anchorX;
          offY = isFinite(hotspotY) ? hotspotY : h * anchorY;
          // 스케일 변화에도 시각적 앵커(핫스팟)가 실제 마우스 위치에 고정되도록
          el.style.transformOrigin = `${offX}px ${offY}px`;
        };
        updateOffset();
        try { new ResizeObserver(updateOffset).observe(el); } catch(_) {}

        // 클릭 시 스케일 애니메이션(변환 문자열에 덧붙이지 않고 구성)
        let targetScale = 1;
        let scale = 1;

        let lastTs = performance.now();
        function raf(now){
          const dt = Math.min((now - lastTs) / 16.67, 3); // 60fps 기준 배수, 과도한 프레임 간격 상한
          lastTs = now;

          // 시간 기반 스프링 적분 (dt 반영)
          const dampPow = Math.pow(DAMP, dt);
          vx = (vx + (x - px) * STIFF * dt) * dampPow;
          vy = (vy + (y - py) * STIFF * dt) * dampPow;
          px += vx; py += vy;

          // 스케일 점진 변화 (조금 더 빠르게)
          scale += (targetScale - scale) * 0.28 * dt;

          el.style.transform = `translate3d(${(px - offX + CALX)}px, ${(py - offY + CALY)}px, 0) scale(${scale})`;
          requestAnimationFrame(raf);
        }

        // 마우스 추적(초기 점프 방지를 위해 첫 지점부터 시작)
        document.addEventListener('mousemove', (e) => {
          x = e.clientX; y = e.clientY;
          if (el.dataset.started !== '1'){
            px = x; py = y; vx = 0; vy = 0;
            el.style.opacity = '1';
            el.dataset.started = '1';
          }
        }, { passive: true });

        // 클릭 피드백
        document.addEventListener('mousedown', () => { targetScale = 0.94; }, { passive: true });
        document.addEventListener('mouseup',   () => { targetScale = 1;    }, { passive: true });

      
        // 보정값을 빠르게 조절하기 위한 개발 보조 함수
        window.__setRoseCursorCal = (x = 0, y = 0) => {
          el.setAttribute('data-cal-x', String(x));
          el.setAttribute('data-cal-y', String(y));
        };

        el.dataset.raf = 'on';
        requestAnimationFrame((t)=>{ lastTs = t; raf(t); });
        return true;
      }

      fetch('../../2.PageElement/Cursor/cursor.html', { cache: 'no-store' })
        .then(res => res.text())
        .then(html => {
          root.innerHTML = html;
          if (!initRoseCursor()){
            const mo = new MutationObserver(() => { if (initRoseCursor()) mo.disconnect(); });
            mo.observe(root, { childList: true, subtree: true });
          }
        })
        .catch(err => console.error('Cursor load failed:', err));
    })();

    // [푸터] HTML 주입
    // 푸터 HTML 로드
    fetch('../../2.PageElement/Footer/Footer.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('footer-placeholder').innerHTML = data;
      });

    // [UI] 맨 위로 버튼(노출/숨김 + 스무스 스크롤)
    // 맨 위로 버튼 동작
    document.addEventListener("DOMContentLoaded", function () {
      const scrollBtn = document.getElementById("scrollTopBtn");
      window.addEventListener("scroll", function () {
        if (document.body.scrollTop > 1 || document.documentElement.scrollTop > 1) {
          scrollBtn.style.display = "flex";
        } else {
          scrollBtn.style.display = "none";
        }
      });
      // 스무스 스크롤로 최상단 이동 함수 노출
      window.scrollToTop = function () {
        window.scrollTo({ top: 0, behavior: "smooth" });  
      };
    });

    // [네비게이션] 스크롤 방향 감지 → 숨김/표시
      (function bindHideNavOnScroll(){
        const THRESH = 6;   // 조금 더 내려가야 반응 (불필요한 깜빡임 방지)
        const TOPSAFE = 48;  // 상단에서는 좀 더 오래 보이게

        let lastY = window.pageYOffset || 0;
        let ticking = false;

        function applyState(y, dy){
          if (y <= TOPSAFE){
            document.body.classList.remove('nav-hidden');
            return;
          }
          if (Math.abs(dy) < THRESH) return;
          if (dy > 0){
            document.body.classList.add('nav-hidden');   // 아래로 → 숨김
          }else{
            document.body.classList.remove('nav-hidden'); // 위로 → 표시
          }
        }

        function onScroll(){
          const y = window.pageYOffset || 0;
          const dy = y - lastY;
          lastY = y;
          if (!ticking){
            ticking = true;
            requestAnimationFrame(() => { applyState(y, dy); ticking = false; });
          }
        }

        window.addEventListener('scroll', onScroll, { passive:true });
        ['wheel','touchmove','touchstart','keydown'].forEach(evt => {
          window.addEventListener(evt, onScroll, { passive:true });
        });

        // 초기 상태
        requestAnimationFrame(() => applyState(window.pageYOffset || 0, 0));
      })();

    // [라우팅] 화면 너비 기준 페이지 전환 // (>=640: Main.html, <=639: Main-mobile.html)
    (function responsiveRoute(){
      const DESKTOP_BASE = 'Main';          // 확장자 없이 베이스명으로 비교
      const MOBILE_BASE  = 'Main-mobile';   // 확장자 없이 베이스명으로 비교

      function isOnBase(base){
        const p = location.pathname.toLowerCase().replace(/\/+$/, '');
        const b = base.toLowerCase().replace(/\.html?$/, '');
        return (
          p.endsWith('/'+b) ||            // .../Main
          p.endsWith('/'+b+'.html') ||    // .../Main.html
          p.endsWith('/'+b+'/') ||        // .../Main/
          p.endsWith('/'+b+'/index.html') // .../Main/index.html
        );
      }
      function goToBase(base){
        const baseDir = location.pathname.replace(/[^/]*$/, '');
        const file = base + '.html';
        location.replace(baseDir + file);
      }

      const mq = window.matchMedia('(max-width: 639px)');
      let ticking = false;
      function check(){
        if (ticking) return; ticking = true;
        requestAnimationFrame(() => {
          const isMobile = mq.matches;
          if (isMobile && isOnBase(DESKTOP_BASE)) goToBase(MOBILE_BASE);
          else if (!isMobile && isOnBase(MOBILE_BASE)) goToBase(DESKTOP_BASE);
          ticking = false;
        });
      }

      if (mq.addEventListener) mq.addEventListener('change', check, {passive:true});
      else if (mq.addListener) mq.addListener(check);
      window.addEventListener('resize', check, {passive:true});
      window.addEventListener('orientationchange', check, {passive:true});
      document.addEventListener('DOMContentLoaded', check);
      setTimeout(check, 120);
      // iOS/Safari에서 주소창 숨김 등으로 viewport 보고가 늦는 경우 대비한 킥 타이머(약 2초)
      let kicks = 0;
      const kickTimer = setInterval(()=>{ kicks++; check(); if (kicks > 10) clearInterval(kickTimer); }, 200);
      // 페이지 복귀/가시성 변화에도 재검사
      window.addEventListener('pageshow', check, {passive:true});
      document.addEventListener('visibilitychange', check, {passive:true});
    })();
  </script>
</body>
</html>