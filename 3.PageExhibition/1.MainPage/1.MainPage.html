<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>TUVD 27th Graduate Exhibition - BLOOM</title>
  <!-- 🔺 스타일시트 연결 -->
  <link rel="stylesheet" href="../../2.PageElement/Tob_nav/Tob_nav.css" />
  <link rel="stylesheet" href="../../2.PageElement/Footer/Footer.css" />
  <link rel="stylesheet" href="../../2.PageElement/Cursor/cursor.css" />
  <link rel="stylesheet" href="1.MainPage.css" />
  
</head>
<body>
  <div id="cursor-placeholder"></div>

  <!-- 🔺 네비게이션 영역 -->
  <div id="nav-placeholder"></div>

  <!-- 🎬 메인 배경 -->
  <div class="video-area">
    <!-- 불필요한 이미지 제거 -->
    <!-- <img src="제목을 입력해주세요_-001.jpeg" alt="Video Placeholder" /> -->
  </div>

  <!-- 🔻 전시 정보 -->
  <div class="poster-stage">
    <img class="poster-horizontal" src="../../1.Picture/1. 27th Graduation/BLOOM_Poster/가로.jpg" alt="가로" loading="lazy" />
  </div>

  <!-- 🔻 푸터 영역 -->
  <div id="footer-placeholder"></div>

  <!-- Scroll to Top Button -->
  <button onclick="scrollToTop()" id="scrollTopBtn" class="scroll-btn">▲</button>

  <!-- 📜 JavaScript -->
  <script>
    function initHeaderHideOnScroll() {
      const root = document.getElementById('nav-placeholder');
      if (!root) return;
      const header = root.querySelector('header');
      if (!header) {
        // If header isn't in the DOM yet, observe and initialize once it appears
        const obs = new MutationObserver(() => {
          const h = root.querySelector('header');
          if (h) {
            obs.disconnect();
            applyHideOnScroll(h);
          }
        });
        obs.observe(root, { childList: true, subtree: true });
        return;
      }
      applyHideOnScroll(header);
    }

    function applyHideOnScroll(header) {
      header.style.transition = 'transform .3s ease';
      let prev = window.pageYOffset || document.documentElement.scrollTop;
      window.addEventListener('scroll', () => {
        const y = window.pageYOffset || document.documentElement.scrollTop;
        header.style.transform = (y > prev) ? 'translateY(-100%)' : 'translateY(0)';
        prev = y;
      }, { passive: true });
    }

    // 네비게이션 HTML 로드
    fetch('../../2.PageElement/Tob_nav/Tob_nav.html')
      .then(res => res.text())
      .then(data => {
        // Replace logo images according to instructions before injecting
        const parser = new DOMParser();
        const doc = parser.parseFromString(data, 'text/html');
        const logoContainer = doc.querySelector('.logo');
        if (logoContainer) {
          const imgs = logoContainer.querySelectorAll('img');
          if (imgs.length > 0) {
            imgs[0].outerHTML = '<img src="../../1.Picture/1. 27th Graduation/BLOOM_LOGO/1.png" alt="장미로고" />';
            if (imgs.length > 1) {
              imgs[1].src = '../../1.Picture/1. 27th Graduation/BLOOM_LOGO/BLOOM_LOGOTAXT.png';
            }
          }
        } else {
          // If no .logo container, check for any img with alt or src matching criteria
          const imgs = doc.querySelectorAll('img');
          for (let img of imgs) {
            const alt = img.getAttribute('alt') || '';
            const src = img.getAttribute('src') || '';
            if (alt.includes('장미로고') || src.includes('BLOOM_LOGO') || src.includes('/대지.png') || src.includes('/대지.png')) {
              img.outerHTML = '<img src="../../1.Picture/1. 27th Graduation/BLOOM_LOGO/1.png" alt="장미로고" />';
              break;
            }
          }
        }
        // --- Normalize nav links so they work from any 3.PageExhibition/* page ---
        // Remove any <base> that might break relative links in the injected fragment
        const baseEl = doc.querySelector('base');
        if (baseEl) baseEl.remove();

        // If there's a clickable logo link, point it to MainPage
        const logoLink = doc.querySelector('a.logo, .logo a');
        if (logoLink && logoLink.setAttribute) {
          logoLink.setAttribute('href', '../1.MainPage/1.MainPage.html');
        }

        // Map menu text -> target path (document-relative)
        const linkMap = {
          'home': '../1.MainPage/1.MainPage.html',
          'about': '../2.AboutPage/About.html',
          'project': '../3.ProjectPage/project2.html',
          'designer': '../4.DesignerPage/Designer.html',
          'guest book': '../5.GuestBookPage/Guest.html',
          'guestbook': '../5.GuestBookPage/Guest.html',
          'gallery': '../6.GalleryPage/Gallery.html'
        };

        // Rewrite anchors based on their text content or existing hrefs
        doc.querySelectorAll('a[href]').forEach(a => {
          const text = (a.textContent || '').trim().toLowerCase();
          const href = (a.getAttribute('href') || '').trim();

          if (linkMap[text]) {
            a.setAttribute('href', linkMap[text]);
            return;
          }
          // Fallback: detect by partial hrefs that point to older/absolute paths
          if (/about/i.test(href)) a.setAttribute('href', linkMap['about']);
          else if (/project/i.test(href)) a.setAttribute('href', linkMap['project']);
          else if (/designer/i.test(href)) a.setAttribute('href', linkMap['designer']);
          else if (/guest.?book/i.test(href)) a.setAttribute('href', linkMap['guest book']);
          else if (/gallery/i.test(href)) a.setAttribute('href', linkMap['gallery']);
          else if (/main|home|index/i.test(href)) a.setAttribute('href', linkMap['home']);
        });
        document.getElementById('nav-placeholder').innerHTML = doc.body.innerHTML;
        // Initialize hide-on-scroll after the header has been injected
        initHeaderHideOnScroll();
      });

    // 푸터 HTML 로드
    fetch('../../2.PageElement/Footer/Footer.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('footer-placeholder').innerHTML = data;
      });

    // 커서 HTML 로드 + 안전 초기화
    function initRoseCursor() {
      const cursor = document.querySelector('.cursor-dot');
      if (!cursor) return false;
      // Prevent duplicate RAF loops if this page re-initializes
      if (cursor.dataset.raf === 'on') return true;

      // Perf hint for smoother transform updates
      cursor.style.willChange = 'transform';

      let x = 0, y = 0, tx = 0, ty = 0, started = false;
      const ease = 0.62; // ↑ bigger = faster follow (0.62 for snappier feel)

      function raf() {
        tx += (x - tx) * ease;
        ty += (y - ty) * ease;
        cursor.style.transform = `translate3d(calc(${tx}px - 50%), calc(${ty}px - 50%), 0)`;
        requestAnimationFrame(raf);
      }

      document.addEventListener('mousemove', (e) => {
        x = e.clientX; y = e.clientY;
        if (!started) { tx = x; ty = y; started = true; }
      }, { passive: true });

      cursor.dataset.raf = 'on';
      requestAnimationFrame(raf);
      return true;
    }

    (function loadCursor(){
      const root = document.getElementById('cursor-placeholder');
      if (!root) return;
      fetch('../../2.PageElement/Cursor/cursor.html')
        .then(res => res.text())
        .then(html => {
          root.innerHTML = html;
          // 바로 초기화 시도
          if (!initRoseCursor()) {
            // 비동기 삽입 지연 대비: MutationObserver로 재시도
            const mo = new MutationObserver(() => {
              if (initRoseCursor()) mo.disconnect();
            });
            mo.observe(root, { childList: true, subtree: true });
          }
        })
        .catch(err => { console.error('Cursor load failed:', err); });
    })();

    // Scroll to Top button functionality
    document.addEventListener("DOMContentLoaded", function () {
      const scrollBtn = document.getElementById("scrollTopBtn");
      window.addEventListener("scroll", function () {
        if (document.body.scrollTop > 1 || document.documentElement.scrollTop > 1) {
          scrollBtn.style.display = "flex";
        } else {
          scrollBtn.style.display = "none";
        }
      });
      window.scrollToTop = function () {
        window.scrollTo({ top: 0, behavior: "smooth" });
      };
    });
  </script>
</body>
</html>